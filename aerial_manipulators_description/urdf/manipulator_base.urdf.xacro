<?xml version="1.0"?>

<robot xmlns:xacro="http://ros.org/wiki/xacro">

  <xacro:macro name="wp_manipulator"
  params="parent *origin">

    <xacro:property name="a0" value="0.04526"/>
    <xacro:property name="a1" value="0.122490"/>
    <xacro:property name="a2" value="0.1365"/>
    <xacro:property name="a3" value="0.075511"/>
    <xacro:property name="a4" value="0.072489"/>
    <xacro:property name="d5" value="0.04526"/>
    <xacro:property name="theta1" value="${pi/2}"/>
    <xacro:property name="alpha2" value="${-pi/2}"/>

    <xacro:property name="mass2" value="0.03"/>
    <xacro:property name="mass1" value="${mass2*a1/a2}"/>
    <xacro:property name="mass3" value="${mass2*a3/a2}"/>
    <xacro:property name="mass4" value="${mass2*a4/a2}"/>
    <xacro:property name="mass5" value="${mass2*d5/a2}"/>

    <xacro:property name="rad" value="0.03"/>

    <link name='base'>
      <inertial>
        <mass value="${mass5}" />
        <origin xyz="0 -${a0/2} 0" rpy="0 0 0"/>
        <inertia
          ixx="${1/2 * mass5 * rad * rad}" ixy="0" ixz="0"
          iyx="0" iyy="${1/12 * mass5 * (3*rad*rad + a0*a0)}" iyz="0"
          izx="0" izy="0" izz="${1/12 * mass5 * (3*rad*rad + a0*a0)}"/>
      </inertial>

      <visual>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <geometry>
          <mesh filename="package://aerial_manipulators_description/meshes/wp_manipulator/base.dae"
            scale="1 1 1" />
        </geometry>
      </visual>
    </link>

    <link name='link1'>
      <inertial>
        <mass value="${mass1}" />
        <origin xyz="0 ${a1/2} 0" rpy="0 0 0"/>
        <inertia
          ixx="${1/12 * mass1 * (3*rad*rad + a1*a1)}" ixy="0" ixz="0"
          iyx="0" iyy="${1/2 * mass1 * rad * rad}" iyz="0"
          izx="0" izy="0" izz="${1/12 * mass1 * (3*rad*rad + a1*a1)}"/>
      </inertial>

      <visual>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <geometry>
          <mesh filename="package://aerial_manipulators_description/meshes/wp_manipulator/link1.dae"
            scale="1 1 1" />
        </geometry>
      </visual>
    </link>

    <link name='link2'>
      <inertial>
        <mass value="${mass2}" />
        <origin xyz="${a2/2} 0 0" rpy="0 0 0"/>
        <inertia
          ixx="${1/2 * mass2 * rad * rad}" ixy="0" ixz="0"
          iyx="0" iyy="${1/12 * mass2 * (3*rad*rad + a2*a2)}" iyz="0"
          izx="0" izy="0" izz="${1/12 * mass2 * (3*rad*rad + a2*a2)}"/>
      </inertial>

      <visual>
        <origin xyz="0 0 0" rpy="0 0 -${pi / 2}" />
        <geometry>
          <mesh filename="package://aerial_manipulators_description/meshes/wp_manipulator/link2.dae"
            scale="1 1 1" />
        </geometry>
      </visual>
    </link>


    <link name='link3'>
      <inertial>
        <mass value="${mass3}" />
        <origin xyz="${a3/2} 0 0" rpy="0 0 0"/>
        <inertia
          ixx="${1/2 * mass3 * rad * rad}" ixy="0" ixz="0"
          iyx="0" iyy="${1/12 * mass3 * (3*rad*rad + a3*a3)}" iyz="0"
          izx="0" izy="0" izz="${1/12 * mass3 * (3*rad*rad + a3*a3)}"/>
      </inertial>

      <visual>
        <origin xyz="0 0 0" rpy="0 ${pi / 2} ${-pi / 2}" />
        <geometry>
          <mesh filename="package://aerial_manipulators_description/meshes/wp_manipulator/link3.dae"
            scale="1 1 1" />
        </geometry>
      </visual>
    </link>

    <link name='link4'>
      <inertial>
        <mass value="${mass4}" />
        <origin xyz="${a4/2} 0 0" rpy="0 0 0"/>
        <inertia
          ixx="${1/2 * mass4 * rad * rad}" ixy="0" ixz="0"
          iyx="0" iyy="${1/12 * mass4 * (3*rad*rad + a4*a4)}" iyz="0"
          izx="0" izy="0" izz="${1/12 * mass4 * (3*rad*rad + a4*a4)}"/>
      </inertial>

      <visual>
        <origin xyz="0 0 0" rpy="0 ${pi / 2} -${pi / 2}" />
        <geometry>
          <mesh filename="package://aerial_manipulators_description/meshes/wp_manipulator/link4.dae"
            scale="1 1 1" />
        </geometry>
      </visual>
    </link>

    <link name='link5'>
      <inertial>
        <mass value="${mass5}" />
        <origin xyz="${d5/2} 0 0" rpy="0 0 0"/>
        <inertia
          ixx="${1/2 * mass5 * rad * rad}" ixy="0" ixz="0"
          iyx="0" iyy="${1/12 * mass5 * (3*rad*rad + d5*d5)}" iyz="0"
          izx="0" izy="0" izz="${1/12 * mass5 * (3*rad*rad + d5*d5)}"/>
      </inertial>

      <visual>
        <origin xyz="0 0 0" rpy="0 ${pi / 2} 0" />
        <geometry>
          <mesh filename="package://aerial_manipulators_description/meshes/wp_manipulator/link5.dae"
            scale="1 1 1" />
        </geometry>
      </visual>
    </link>

    <link name='end_effector_base'>
      <inertial>
        <mass value="0.00001" />
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <inertia
          ixx="0.00001" ixy="0" ixz="0"
          iyx="0" iyy="0.00001" iyz="0"
          izx="0" izy="0" izz="0.00001"/>
      </inertial>

      <visual>
        <geometry>
          <sphere radius="0.005"/>
        </geometry>
      </visual>
    </link>

    <joint name="wp_base_joint" type="fixed">
      <parent link="${parent}"/>
      <child link="base"/>
      <xacro:insert_block name="origin"/>
    </joint>

    <joint name="joint1" type="revolute">
      <parent link="base"/>
      <child link="link1"/>
      <!-- Adjust Gazebo coordinate system to link1 coordinate system -->
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <limit upper="1.57" lower="-1.57" effort="10000000" velocity="46"/>
      <axis xyz="0 0 1" />
    </joint>

    <joint name="joint2" type="revolute">
      <parent link="link1"/>
      <child link="link2"/>
      <origin xyz="0 ${a1} 0" rpy="0 0 ${theta1}"/>
      <limit upper="2.0" lower="-2.0" effort="10000000" velocity="46"/>
      <axis xyz="0 0 1" />
    </joint>

    <joint name="joint3" type="revolute">
      <parent link="link2"/>
      <child link="link3"/>
      <origin xyz="${a2} 0 0" rpy="${alpha2} 0 0"/>
      <limit upper="1.57" lower="-1.57" effort="10000000" velocity="46"/>
      <axis xyz="0 0 1" />
    </joint>

    <joint name="joint4" type="revolute">
      <parent link="link3"/>
      <child link="link4"/>
      <origin xyz="${a3} 0 0" rpy="0 0 0"/>
      <limit upper="2.0" lower="-2.0" effort="10000000" velocity="46"/>
      <axis xyz="0 0 1" />
    </joint>

    <joint name="joint5" type="revolute">
      <parent link="link4"/>
      <child link="link5"/>
      <origin xyz="${a4} 0 0" rpy="0 0 0"/>
      <limit upper="2.3" lower="-2.3" effort="10000000" velocity="46"/>
      <axis xyz="0 0 1" />
    </joint>

    <joint name="jointEndEffectorBase" type="fixed">
      <parent link="link5"/>
      <child link="end_effector_base"/>
      <origin xyz="${d5} 0 0" rpy="0 0 0"/>
    </joint>

  </xacro:macro>

  <xacro:macro name="wp_manipulator_3rx"
  params="parent *origin">

    <xacro:property name="a0" value="0.04526"/>
    <xacro:property name="a1" value="0.122490"/>
    <xacro:property name="a2" value="0.1365"/>
    <xacro:property name="a3" value="0.075511"/>
    <xacro:property name="a4" value="0.072489"/>
    <xacro:property name="d5" value="0.04526"/>
    <xacro:property name="theta1" value="${pi/2}"/>
    <xacro:property name="alpha2" value="${-pi/2}"/>

    <xacro:property name="mass2" value="0.03"/>
    <xacro:property name="mass1" value="${mass2*a1/a2}"/>
    <xacro:property name="mass3" value="${mass2*a3/a2}"/>
    <xacro:property name="mass4" value="${mass2*a4/a2}"/>
    <xacro:property name="mass5" value="${mass2*d5/a2}"/>

    <xacro:property name="rad" value="0.03"/>

    <link name='base'>
      <inertial>
        <mass value="${mass5}" />
        <origin xyz="0 -${a0/2} 0" rpy="0 0 0"/>
        <inertia
          ixx="${1/2 * mass5 * rad * rad}" ixy="0" ixz="0"
          iyx="0" iyy="${1/12 * mass5 * (3*rad*rad + a0*a0)}" iyz="0"
          izx="0" izy="0" izz="${1/12 * mass5 * (3*rad*rad + a0*a0)}"/>
      </inertial>

      <visual>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <geometry>
          <mesh filename="package://aerial_manipulators_description/meshes/wp_manipulator/base.dae"
            scale="1 1 1" />
        </geometry>
      </visual>
    </link>

    <link name='link1'>
      <inertial>
        <mass value="${mass3}" />
        <origin xyz="${a3/2} 0 0" rpy="0 0 0"/>
        <inertia
          ixx="${1/2 * mass3 * rad * rad}" ixy="0" ixz="0"
          iyx="0" iyy="${1/12 * mass3 * (3*rad*rad + a3*a3)}" iyz="0"
          izx="0" izy="0" izz="${1/12 * mass3 * (3*rad*rad + a3*a3)}"/>
      </inertial>

      <visual>
        <origin xyz="0 0 0" rpy="0 ${pi / 2} ${-pi / 2}" />
        <geometry>
          <mesh filename="package://aerial_manipulators_description/meshes/wp_manipulator/link3.dae"
            scale="1 1 1" />
        </geometry>
      </visual>
    </link>

    <link name='link2'>
      <inertial>
        <mass value="${mass4}" />
        <origin xyz="${a4/2} 0 0" rpy="0 0 0"/>
        <inertia
          ixx="${1/2 * mass4 * rad * rad}" ixy="0" ixz="0"
          iyx="0" iyy="${1/12 * mass4 * (3*rad*rad + a4*a4)}" iyz="0"
          izx="0" izy="0" izz="${1/12 * mass4 * (3*rad*rad + a4*a4)}"/>
      </inertial>

      <visual>
        <origin xyz="0 0 0" rpy="0 ${pi / 2} -${pi / 2}" />
        <geometry>
          <mesh filename="package://aerial_manipulators_description/meshes/wp_manipulator/link4.dae"
            scale="1 1 1" />
        </geometry>
      </visual>
    </link>

    <link name='link3'>
      <inertial>
        <mass value="${mass5}" />
        <origin xyz="${d5/2} 0 0" rpy="0 0 0"/>
        <inertia
          ixx="${1/2 * mass5 * rad * rad}" ixy="0" ixz="0"
          iyx="0" iyy="${1/12 * mass5 * (3*rad*rad + d5*d5)}" iyz="0"
          izx="0" izy="0" izz="${1/12 * mass5 * (3*rad*rad + d5*d5)}"/>
      </inertial>

      <visual>
        <origin xyz="0 0 0" rpy="0 ${pi / 2} 0" />
        <geometry>
          <mesh filename="package://aerial_manipulators_description/meshes/wp_manipulator/link5.dae"
            scale="1 1 1" />
        </geometry>
      </visual>
    </link>

    <link name='end_effector_base'>
      <inertial>
        <mass value="0.00001" />
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <inertia
          ixx="0.00001" ixy="0" ixz="0"
          iyx="0" iyy="0.00001" iyz="0"
          izx="0" izy="0" izz="0.00001"/>
      </inertial>

      <visual>
        <geometry>
          <sphere radius="0.005"/>
        </geometry>
      </visual>
    </link>

    <joint name="wp_base_joint" type="fixed">
      <parent link="${parent}"/>
      <child link="base"/>
      <xacro:insert_block name="origin"/>
    </joint>

    <joint name="joint1" type="revolute">
      <parent link="base"/>
      <child link="link1"/>
      <origin xyz="${a2} 0 0" rpy="${alpha2} 0 0"/>
      <limit upper="1.57" lower="-1.57" effort="10000000" velocity="46"/>
      <axis xyz="0 0 1" />
    </joint>

    <joint name="joint2" type="revolute">
      <parent link="link1"/>
      <child link="link2"/>
      <origin xyz="${a3} 0 0" rpy="0 0 0"/>
      <limit upper="2.0" lower="-2.0" effort="10000000" velocity="46"/>
      <axis xyz="0 0 1" />
    </joint>

    <joint name="joint3" type="revolute">
      <parent link="link2"/>
      <child link="link3"/>
      <origin xyz="${a4} 0 0" rpy="0 0 0"/>
      <limit upper="2.3" lower="-2.3" effort="10000000" velocity="46"/>
      <axis xyz="0 0 1" />
    </joint>

    <joint name="jointEndEffectorBase" type="fixed">
      <parent link="link3"/>
      <child link="end_effector_base"/>
      <origin xyz="${d5} 0 0" rpy="0 0 0"/>
    </joint>

  </xacro:macro>

  <xacro:macro name="wp_manipulator_3r"
  params="parent *origin">

    <xacro:property name="a0" value="0.04526"/>
    <xacro:property name="a1" value="0.122490"/>
    <xacro:property name="a2" value="0.1365"/>
    <xacro:property name="a3" value="0.075511"/>
    <xacro:property name="a4" value="0.072489"/>
    <xacro:property name="d5" value="0.035"/>
    <xacro:property name="theta1" value="${pi/2}"/>
    <xacro:property name="alpha2" value="${-pi/2}"/>

    <xacro:property name="mass2" value="0.03"/>
    <xacro:property name="mass1" value="${mass2*a1/a2}"/>
    <xacro:property name="mass3" value="${mass2*a3/a2}"/>
    <xacro:property name="mass4" value="${mass2*a4/a2}"/>
    <xacro:property name="mass5" value="${mass2*d5/a2}"/>

    <xacro:property name="rad" value="0.03"/>

    <link name='base'>
      <inertial>
        <mass value="${mass5}" />
        <origin xyz="0 -${a0/2} 0" rpy="0 0 0"/>
        <inertia
          ixx="${1/2 * mass5 * rad * rad}" ixy="0" ixz="0"
          iyx="0" iyy="${1/12 * mass5 * (3*rad*rad + a0*a0)}" iyz="0"
          izx="0" izy="0" izz="${1/12 * mass5 * (3*rad*rad + a0*a0)}"/>
      </inertial>

      <visual>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <geometry>
          <mesh filename="package://aerial_manipulators_description/meshes/wp_manipulator/base.dae"
            scale="1 1 1" />
        </geometry>
      </visual>
    </link>

    <link name='link1'>
      <inertial>
        <mass value="${mass2}" />
        <origin xyz="${a2/2} 0 0" rpy="0 0 0"/>
        <inertia
          ixx="${1/2 * mass2 * rad * rad}" ixy="0" ixz="0"
          iyx="0" iyy="${1/12 * mass2 * (3*rad*rad + a2*a2)}" iyz="0"
          izx="0" izy="0" izz="${1/12 * mass2 * (3*rad*rad + a2*a2)}"/>
      </inertial>

      <visual>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <geometry>
          <mesh filename="package://aerial_manipulators_description/meshes/wp_manipulator/link2_rotated.dae"
            scale="1 1 1" />
        </geometry>
      </visual>
    </link>

    <link name='link2'>
      <inertial>
        <mass value="${mass4}" />
        <origin xyz="${a4/2} 0 0" rpy="0 0 0"/>
        <inertia
          ixx="${1/2 * mass4 * rad * rad}" ixy="0" ixz="0"
          iyx="0" iyy="${1/12 * mass4 * (3*rad*rad + a4*a4)}" iyz="0"
          izx="0" izy="0" izz="${1/12 * mass4 * (3*rad*rad + a4*a4)}"/>
      </inertial>

      <visual>
        <origin xyz="0 0 0" rpy="0 ${pi/2} ${-pi/2}" />
        <geometry>
          <mesh filename="package://aerial_manipulators_description/meshes/wp_manipulator/link4.dae"
            scale="1 1 1" />
        </geometry>
      </visual>
    </link>

    <link name='link3'>
      <inertial>
        <mass value="${mass5}" />
        <origin xyz="${a0/2} 0 0" rpy="0 0 0"/>
        <inertia
          ixx="${1/2 * mass5 * rad * rad}" ixy="0" ixz="0"
          iyx="0" iyy="${1/12 * mass5 * (3*rad*rad + a0*a0)}" iyz="0"
          izx="0" izy="0" izz="${1/12 * mass5 * (3*rad*rad + a0*a0)}"/>
      </inertial>

      <visual>
        <origin xyz="0 0 0" rpy="0 ${pi / 2} 0" />
        <geometry>
          <mesh filename="package://aerial_manipulators_description/meshes/wp_manipulator/link5.dae"
            scale="1 1 1" />
        </geometry>
      </visual>
    </link>

    <link name='end_effector_base'>
      <inertial>
        <mass value="0.00001" />
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <inertia
          ixx="0.00001" ixy="0" ixz="0"
          iyx="0" iyy="0.00001" iyz="0"
          izx="0" izy="0" izz="0.00001"/>
      </inertial>

      <visual>
        <geometry>
          <sphere radius="0.005"/>
        </geometry>
      </visual>
    </link>

    <joint name="wp_base_joint" type="fixed">
      <parent link="${parent}"/>
      <child link="base"/>
      <xacro:insert_block name="origin"/>
    </joint>

    <joint name="joint1" type="revolute">
      <parent link="base"/>
      <child link="link1"/>
      <!-- Adjust Gazebo coordinate system to link1 coordinate system -->
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <limit upper="1.57" lower="-0.25" effort="10000000" velocity="46"/>
      <axis xyz="0 0 1" />
    </joint>

    <joint name="joint2" type="revolute">
      <parent link="link1"/>
      <child link="link2"/>
      <origin xyz="0 ${a2} 0" rpy="${-pi/2} 0 ${pi/2}"/>
      <limit upper="1.57" lower="-1.57" effort="10000000" velocity="46"/>
      <axis xyz="0 0 1" />
    </joint>

    <joint name="joint3" type="revolute">
      <parent link="link2"/>
      <child link="link3"/>
      <origin xyz="${a4} 0 0" rpy="0 0 0"/>
      <limit upper="1.57" lower="-1.57" effort="10000000" velocity="46"/>
      <axis xyz="0 0 1" />
    </joint>

    <joint name="jointEndEffectorBase" type="fixed">
      <parent link="link3"/>
      <child link="end_effector_base"/>
      <origin xyz="${d5} 0 0" rpy="0 0 0"/>
    </joint>

  </xacro:macro>

  <!-- We add a <transmission> block for every joint that we wish to actuate. -->
  <xacro:macro name="transmisija" params="trans_number joint_name">
    <transmission name="transmission_${trans_number}">
      <type>transmission_interface/SimpleTransmission</type>
      <joint name="${joint_name}">
        <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
      </joint>
      <actuator name="motor_${trans_number}">
        <hardwareInterface>hardware_interface/EffortActuatorInterface</hardwareInterface>
        <mechanicalReduction>1</mechanicalReduction>
      </actuator>
    </transmission>
  </xacro:macro>

</robot>
